name: Update Project Version

on:
  workflow_dispatch:   # Manual trigger

jobs:
  update-version:
    runs-on: windows-latest
    permissions:
      contents: write

    steps:
    - name: Checkout Code
      uses: actions/checkout@v4
  
    - name: Generate update.json
      shell: pwsh
      run: |
        $json = @{
            version = "1.0.1"
            url     = "https://github.com/MrPcGamerYT/Optimizer/releases/latest/download/OptimizerSetup.exe"
        } | ConvertTo-Json -Compress
        $json | Set-Content -Path update.json -Encoding UTF8
        Write-Host "Generated update.json: $json"

    - name: Commit updater.json
      shell: pwsh
      run: |
        git config user.name "github-actions"
        git config user.email "github-actions@github.com"
        git add update.json
        git commit -m "Update update.json to $env:VERSION" || echo "No changes"
        git push

    - name: Update AssemblyInfo.cs
      shell: pwsh
      run: |
        $sc = @{
            using System.Reflection;
            using System.Runtime.CompilerServices;
            using System.Runtime.InteropServices;

            // General Information about an assembly is controlled through the following
            // set of attributes. Change these attribute values to modify the information
            // associated with an assembly.
            [assembly: AssemblyTitle("Optimizer")]
            [assembly: AssemblyDescription("System Optimizer Tool")]
            [assembly: AssemblyConfiguration("")]
            [assembly: AssemblyCompany("YoyTuber")]
            [assembly: AssemblyProduct("Optimizer")]
            [assembly: AssemblyCopyright("© 2026 Mr.Pc Gamer. All Rights Reserved.")]
            [assembly: AssemblyTrademark("")]
            [assembly: AssemblyCulture("")]

            // Setting ComVisible to false makes the types in this assembly not visible
            // to COM components.  If you need to access a type in this assembly from
            // COM, set the ComVisible attribute to true on that type.
            [assembly: ComVisible(false)]

            // The following GUID is for the ID of the typelib if this project is exposed to COM
            [assembly: Guid("08e58f25-5dd2-42fe-833a-23ad7133b493")]

            // Version information for an assembly consists of the following four values:
            //
            //      Major Version
            //      Minor Version
            //      Build Number
            //      Revision
            //
            [assembly: AssemblyVersion("1.0.1")]
            [assembly: AssemblyFileVersion("1.0.1")]



        } | Set-Content $assemblyPath -Encoding UTF8

        Write-Host "AssemblyInfo.cs updated to version $sc"

    # 3️⃣ Commit changes
    - name: Commit updated AssemblyInfo.cs
      shell: pwsh
      run: |
        git config user.name "github-actions"
        git config user.email "github-actions@github.com"
        git add Optimizer/Properties/AssemblyInfo.cs
        git commit -m "Update AssemblyInfo.cs to version $version" || echo "No changes"
        git push
